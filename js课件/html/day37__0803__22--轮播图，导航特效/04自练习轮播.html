<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            list-style: none;
            text-decoration: none;
        }

        .swiper {
            width: 900px;
            height: 600px;
            margin: 80px auto;
            position: relative;
            overflow: hidden;
        }

        .swiper-ul {
            width: 500%;
            height: 600px;
            position: relative;
            left: 0;
            top: 0;
        }

        .slide {
            width: 900px;
            height: 600px;
            float: left;
            text-align: center;
            line-height: 600px;
            font-size: 60px;
            color: #fff;
            background: rgb(0, 0, 255);
        }

        .slide:nth-child(2) {
            background: rgb(255, 0, 0);
        }

        .slide:nth-child(3) {
            background: rgb(0, 255, 0);
        }

        .slide:nth-child(4) {
            background: rgb(255, 0, 255);
        }

        .btn {
            width: 30px;
            height: 30px;
            position: absolute;
            background: #fff;
            color: #333;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
            font-size: 28px;
            line-height: 30px;
            display: none;
        }

        /*  .swiper:hover {
            cursor: pointer;
        } */

        .btn:hover,
        .circle li:hover {
            cursor: pointer;
        }

        .lbtn {
            left: 0;
        }

        .rbtn {
            right: 0;
        }


        .circle {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
        }

        .circle li {
            width: 16px;
            height: 16px;
            border: 1px solid #333;
            float: left;
            margin-right: 8px;
            border-radius: 50%;
            background: #666;
            opacity: 0.6;
        }

        .circle li.on {
            opacity: 1;
            background: #f30;
        }

        .circle li:last-child {
            margin: 0;
        }
    </style>
</head>

<body>
    <!-- 
        
        2022年8月3日16:04:38
     -->

    <div class="swiper">
        <ul class="swiper-ul">
            <li class="slide">slide1</li>
            <li class="slide">slide2</li>
            <li class="slide">slide3</li>
            <li class="slide">slide4</li>
        </ul>
        <div class="row">
            <div class="btn lbtn"> ← </div>
            <div class="btn rbtn">→ </div>
        </div>
        <!-- <ol class="circle">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ol> -->
    </div>

    <script>
        var swiper = document.querySelector('.swiper');
        var ol = document.createElement('ol');
        swiper.appendChild(ol);
        ol.className = 'circle';
        var swiperUl = document.querySelector('.swiper-ul');
        var slide = document.querySelectorAll('.slide');
        var lbtn = document.querySelector('.lbtn');
        var rbtn = document.querySelector('.rbtn');
        var swiperW = swiper.offsetWidth;
        var row = document.querySelector('.row');
        // var slideW = getComputedStyle(swiper, null).width;  ---不用这个，因为这个有单位。 900px
        // console.log(swiperW, slideW);//900 900px

        var circle = document.querySelector('.circle');
        console.log(slide);

        for (var n = 0; n < slide.length; n++) {
            var cli = document.createElement('li');
            circle.appendChild(cli);
        }
        var clis = document.querySelectorAll('.circle li');
        clis[0].className = 'on';
        var copySlide = slide[0].cloneNode(true);
        console.log(copySlide);
        swiperUl.appendChild(copySlide);
        console.log(swiperUl);
        var nslide = document.querySelectorAll('.slide');
        console.log(nslide, nslide.length);
        console.log(slide.length);
        swiperUl.style.width = swiperW * nslide.length + 'px';
        var timer = setInterval(function () {
            rbtn.onclick();
        }, 2500)
        swiper.onmouseenter = function () {
            lbtn.style.display = 'block'
            rbtn.style.display = 'block'
            clearInterval(timer);

        }
        swiper.onmouseleave = function () {
            lbtn.style.display = 'none'
            rbtn.style.display = 'none'
            timer = setInterval(function () {
                rbtn.onclick();
            }, 2500);
        }
        for (var cr = 0; cr < clis.length; cr++) {
            clis[cr].setAttribute('index', cr);
            clis[cr].onclick = function () {
                var index = this.getAttribute('index');
                i = index;
                cir = index;
                run(index);
                animate(swiperUl, -index * swiperW);
            }
        }
        var i = 0;
        var cir = 0;
        var flag = true;
        rbtn.onclick = function () {
            if (flag) {
                flag = false;
                if (i >= nslide.length - 1) {
                    console.log('i=' + i);
                    i = 0;
                    swiperUl.style.left = '0px';
                }
                i++;
                cir++;
                console.log(i);
                animate(swiperUl, -i * swiperW, function () {
                    flag = true;
                });
                if (cir >= clis.length) {
                    cir = 0;
                }
                run(cir);
            }

        }
        lbtn.onclick = function () {
            if (flag) {
                flag = false;
                if (i <= 0) {
                    console.log('i=' + i);
                    i = nslide.length - 1;
                    swiperUl.style.left = -i * swiperW + 'px';
                }
                i--;
                cir--;
                console.log(i);
                animate(swiperUl, -i * swiperW, function () {
                    flag = true;
                });
                if (cir < 0) {
                    cir = clis.length - 1;
                }
                run(cir);
            }
        }
        console.log('w=' + swiperUl.offsetLeft);

        function run(num) {
            for (var i = 0; i < clis.length; i++) {
                clis[i].classList.remove('on');
            }
            clis[num].classList.add('on');
        }


        function animate(obj, end, callback) {

            clearInterval(timer);
            var timer;
            timer = setInterval(function () {
                var header = obj.offsetLeft;
                var speed = (end - header) / 10;
                if (header == end) {
                    clearInterval(timer);
                    callback && callback();
                }
                speed = speed > 0 ? Math.ceil(speed) : Math.floor(speed);
                newL = speed + header;
                obj.style.left = newL + 'px';
            }, 15)
        }




    </script>
</body>

</html>