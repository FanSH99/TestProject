"use strict";(self["webpackChunkele"]=self["webpackChunkele"]||[]).push([[501],{2501:function(s,t,i){i.r(t),i.d(t,{default:function(){return f}});var e=function(){var s=this,t=s._self._c;return t("div",[t("div",{staticClass:"foods"},[t("div",{ref:"navLeft",staticClass:"left"},[t("ul",s._l(s.foodsList,(function(i,e){return t("li",{key:e,class:{active:s.getIndex==e},on:{click:function(t){return s.changeFoods(e)}}},[s._v(s._s(i.name))])})),0)]),t("div",{ref:"content",staticClass:"right"},[t("div",{staticStyle:{"padding-bottom":"50px"}},s._l(s.foodsList,(function(i,e){return t("div",{key:e,ref:"foodscontent",refInFor:!0},[t("div",{staticClass:"title"},[t("span",{staticClass:"name"},[s._v(s._s(i.name))]),s._v(" "+s._s(i.description)+" ")]),t("div",s._l(i.foods,(function(i,o){return t("div",{key:o,staticClass:"foods_item"},[t("div",{staticClass:"left_img"},[t("img",{directives:[{name:"lazy",rawName:"v-lazy",value:`https://elm.cangdu.org/img/${i.image_path}`,expression:"`https://elm.cangdu.org/img/${foods.image_path}`"}],attrs:{alt:""}})]),t("div",{staticClass:"right_content"},[t("p",{staticClass:"name"},[s._v(s._s(i.name))]),t("p",{staticClass:"msg"},[s._v(" 月售"+s._s(i.month_sales)+"份 好评率"+s._s(i.satisfy_rate)+"% ")]),t("div",{staticClass:"price"},[t("div",{staticClass:"pricenum"},[s._v("￥"+s._s(i.specfoods[0].price))]),t("div",{staticClass:"price_num"},[t("div",{directives:[{name:"show",rawName:"v-show",value:0!=i.num,expression:"foods.num!=0"}],staticClass:"reduce",on:{click:function(t){return s.reduce(i.specfoods)}}},[s._v(" - ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:0!=i.num,expression:"foods.num!=0"}],staticClass:"num"},[s._v(s._s(i.num))]),1==i.specfoods.length?t("div",{staticClass:"add",on:{click:function(t){return s.add(i.specfoods[0])}}},[s._v(" + ")]):t("div",[t("van-tag",{attrs:{type:"primary"},on:{click:function(t){return s.changeSku(e,o)}}},[s._v("选规格")])],1)])])])])})),0)])})),0)])]),t("div",[t("van-popup",{style:{width:"80%"},model:{value:s.show,callback:function(t){s.show=t},expression:"show"}},[t("div",{staticClass:"foodsName"},[s._v(" "+s._s(s.foodsName)+" "),t("van-icon",{staticClass:"close",attrs:{name:"cross"},on:{click:function(t){s.show=!1}}})],1),t("div",{staticClass:"sku_title"},[s._v(" 规格 ")]),t("div",{staticClass:"skuList"},s._l(s.skuList,(function(i,e){return t("div",{key:e,class:{sku:!0,active:s.skuActive==e},on:{click:function(t){s.skuActive=e}}},[s._v(" "+s._s(i.specs_name)+" ")])})),0),t("footer",[0!=s.skuList.length?t("div",{staticClass:"price"},[s._v(" ￥"+s._s(s.skuList[s.skuActive].price)+" ")]):s._e(),t("div",[t("van-button",{attrs:{type:"info",size:"mini"},on:{click:s.addSkuCart}},[s._v("加入购物车")])],1)])])],1)])},o=[],a=(i(7658),i(333)),n=i(2922),c=i(9998),r=i(8848),l={props:["restaurant_id"],data(){return{foodsList:[],rightScroll:null,leftScroll:null,scrollHeight:[],scrollY:0,show:!1,skuList:[],foodsName:"",skuActive:0}},async created(){a.Z.$on("clearCart",(()=>{this.renderNum()}));let s=await(0,c.UJ)({restaurant_id:this.restaurant_id});console.log(s),this.foodsList=s.data,this.renderNum(),this.$emit("over"),this.$nextTick((()=>{this.rightScroll=new n.ZP(this.$refs.content,{click:!0,probeType:3}),this.rightScroll.on("scroll",(s=>{this.scrollY=Math.abs(s.y)})),this.leftScroll=new n.ZP(this.$refs.navLeft,{click:!0,probeType:3}),this.getHeight()}))},methods:{getHeight(){this.scrollHeight=[];let s=0;this.scrollHeight.push(0);let t=this.$refs.foodscontent;t.forEach((t=>{this.scrollHeight.push(s+=t.clientHeight)})),console.log(this.scrollHeight)},changeFoods(s){this.rightScroll.scrollTo(0,-this.scrollHeight[s],300)},add(s){this.$store.commit("addCart",s),this.renderNum()},renderNum(){let s=this.$store.state.cartList;if(s||(s={}),!s[this.restaurant_id])return this.foodsList.forEach((s=>{s.foods.forEach((s=>{this.$set(s,"num",0)}))})),void console.log(this.foodsList);let t=s[this.restaurant_id];console.log(t),this.foodsList.forEach((s=>{s.foods.forEach((s=>{let i=t.findIndex((t=>t.item_id==s.item_id));-1!=i?this.$set(s,"num",t[i].num):this.$set(s,"num",0)}))}))},reduce(s){if(s.length>1)return void(0,r.Z)("多规格商品需要去购物车删除！！");let t=s[0];this.$store.commit("reduceCart",t),this.renderNum()},changeSku(s,t){let i=this.foodsList[s].foods[t];this.foodsName=i.name,console.log(i),this.skuList=i.specfoods,this.show=!0},addSkuCart(){let s=this.skuList[this.skuActive];console.log(s),this.$store.commit("addCart",s),this.renderNum(),this.show=!1}},computed:{getIndex(){return this.scrollHeight.findIndex(((s,t)=>this.scrollY>=s&&this.scrollY<this.scrollHeight[t+1]))}}},d=l,h=i(1001),u=(0,h.Z)(d,e,o,!1,null,"48aeae69",null),f=u.exports},333:function(s,t,i){var e=i(6369);let o=new e.ZP;t["Z"]=o}}]);
//# sourceMappingURL=501.3d4d5aec.js.map