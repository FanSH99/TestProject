<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>添加话题</title>
    <link rel="shortcut icon" href="../img/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/media.css">
</head>

<body>
    <!-- 页面头部内容 -->
    <header>
        <div class="header_main">
            <div class="header_left">
                北游论坛
            </div>
        </div>
    </header>
    <div class="main">
        <div class="addmsg">
            <div class="form-group">
                <label for="name">请输入话题</label>
                <textarea type="text" name="" class="form-control" id="talk" cols="30" rows="10"
                    placeholder="请输入话题"></textarea>
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-success btn-block" id="addMsgBtn">发表</button>
            </div>
        </div>
    </div>

</body>
<script src="../js/jquery.js"></script>
<script src="../js/ajax.js"></script>
<script src="../js/time.js"></script>
<script>
    $(".header_left").click(() => {
        window.location.href = '/'
    })

    let userInfo = localStorage.getItem("userInfo");
    if (!userInfo) {
        // 跳转到登录页面
        window.location.href = './login.html'
    }
    userInfo = JSON.parse(userInfo);
    let username = userInfo.username;
    $("#addMsgBtn").click(async () => {
        // 获取输入框内容
        let talk = $("#talk").val();
        console.log(talk);
        // 判断是否都有值
        let img_url = userInfo.img_url;
        let time = getTime();
        console.log(username, talk, img_url, time);
        if (!talk || talk == "") {
            alert("请您先补充完整信息")
            return
        }
        let res = await request("/adMsg", 'post', { username, talk, img_url, time });
        console.log(res);
        if (res.code == 0) {
            alert(res.msg);
            window.location.href = "/"
            return;
        }
        alert(res.msg);
    })

    // let time = new Date().getTime();//1661928726552
    // console.log(time);

    /*
    为了保证数据搜索的唯一性，并且保证其他顺序不乱，可以添加时间戳为唯一标识。
    let time_str=new Date().getTime()
    
    */
</script>

</html>